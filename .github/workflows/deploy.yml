name: Extract and Deploy to GitHub Pages

on:
  push:
      branches: [main]

      permissions:
        contents: write
          pages: write
            id-token: write

            jobs:
              deploy:
                  runs-on: ubuntu-latest
                      steps:
                            - uses: actions/checkout@v4

                                  - name: Extract zip
                                          run: |
                                                    unzip cofi-site.zip -d extracted
                                                              # Move contents up if there's a single nested folder
                                                                        CONTENTS=$(ls extracted)
                                                                                  COUNT=$(ls extracted | wc -l)
                                                                                            if [ "$COUNT" -eq 1 ] && [ -d "extracted/$CONTENTS" ]; then
                                                                                                        mv extracted/$CONTENTS/* extracted/ 2>/dev/null || true
                                                                                                                    mv extracted/$CONTENTS/.* extracted/ 2>/dev/null || true
                                                                                                                                rmdir extracted/$CONTENTS 2>/dev/null || true
                                                                                                                                          fi
                                                                                                                                          
                                                                                                                                                - name: Deploy to GitHub Pages
                                                                                                                                                        uses: peaceiris/actions-gh-pages@v4
                                                                                                                                                                with:
                                                                                                                                                                          github_token: ${{ secrets.GITHUB_TOKEN }}
                                                                                                                                                                                    publish_dir: ./extracted
                                                                                                                                                                                              cname: cofi.so
